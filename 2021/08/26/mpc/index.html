<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="SmartBidGetting startedRequirementsWork with Hyperledger Fabric v. 1.1.1-mpc (WARNING you need to install 1.1.1-mpc as described below) Follow https:&#x2F;&#x2F;hyperledger-fabric.readthedocs.io&#x2F;en&#x2F;latest&#x2F;prere">
<meta property="og:type" content="article">
<meta property="og:title" content="mpc">
<meta property="og:url" content="http://example.com/2021/08/26/mpc/index.html">
<meta property="og:site_name" content="cool-jun的博客">
<meta property="og:description" content="SmartBidGetting startedRequirementsWork with Hyperledger Fabric v. 1.1.1-mpc (WARNING you need to install 1.1.1-mpc as described below) Follow https:&#x2F;&#x2F;hyperledger-fabric.readthedocs.io&#x2F;en&#x2F;latest&#x2F;prere">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-26T08:25:07.000Z">
<meta property="article:modified_time" content="2021-12-21T03:44:26.518Z">
<meta property="article:author" content="He Jun">
<meta property="article:tag" content="安全多方计算">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/08/26/mpc/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>mpc | cool-jun的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">cool-jun的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">record my life</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/26/mpc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="He Jun">
      <meta itemprop="description" content="Like Sunday，Like Rain">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cool-jun的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mpc
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-26 16:25:07" itemprop="dateCreated datePublished" datetime="2021-08-26T16:25:07+08:00">2021-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-21 11:44:26" itemprop="dateModified" datetime="2021-12-21T11:44:26+08:00">2021-12-21</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/08/26/mpc/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/08/26/mpc/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="SmartBid"><a href="#SmartBid" class="headerlink" title="SmartBid"></a>SmartBid</h1><h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><h3 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h3><p>Work with Hyperledger Fabric v. 1.1.1-mpc (WARNING you need to install 1.1.1-mpc as described below)</p>
<p>Follow <a target="_blank" rel="noopener" href="https://hyperledger-fabric.readthedocs.io/en/latest/prereqs.html">https://hyperledger-fabric.readthedocs.io/en/latest/prereqs.html</a> and <a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric-sdk-node">https://github.com/hyperledger/fabric-sdk-node</a>. In particular:</p>
<ul>
<li><p><code>go</code> <a target="_blank" rel="noopener" href="https://golang.org/">https://golang.org/</a> - most recent version. On Ubuntu DO NOT INSTALL USING <code>apt-get</code>. It will NOT work (outdated version). You may use the <code>snap</code> version but you might have the following issue: <a target="_blank" rel="noopener" href="https://github.com/golang/go/issues/24674#issuecomment-379919460">https://github.com/golang/go/issues/24674#issuecomment-379919460</a>. Instead, it is better to manually install it in your home directory:</p>
<pre><code>  mkdir ~/opt
  cd ~/opt
  wget https://dl.google.com/go/go1.10.3.linux-amd64.tar.gz
  tar xvzf go1.10.3.linux-amd64.tar.gz</code></pre>
<p>  and add the following lines to <code>~/.zshrc</code> or <code>~/.bashrc</code></p>
<pre><code>  export GOROOT=$HOME/opt/go
  export PATH=$PATH:$GOROOT/bin</code></pre>
</li>
</ul>
<ul>
<li><code>docker</code> <a target="_blank" rel="noopener" href="https://www.docker.com/products/overview">https://www.docker.com/products/overview</a>- v1.13 or higher</li>
<li><code>docker compose</code> <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/overview/">https://docs.docker.com/compose/overview/</a> - v1.8 or higher (<code>sudo pip install docker-compose</code>)</li>
<li><code>node.js</code>, <code>npm</code> <a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a><ul>
<li>node runtime version and 8.4.0 or higher (NodeJS &gt; 8 is not supported by <code>fabric-node-sdk</code>, and we need NodeJS &gt;= 8 for async/await)</li>
<li>npm v3.10.10</li>
</ul>
</li>
<li>on MacOS: need <code>gnu-tar</code> and <code>coreutils</code>: with Homebrew: <code>brew install gnu-tar --with-default-names</code>, <code>brew install coreutils</code> (needs to change path)</li>
</ul>
<p>In addition:</p>
<ul>
<li><code>gulp</code> - install via <code>npm install -g gulp</code></li>
<li><code>yarn</code> - install via <code>npm install -g yarn</code> / <code>brew install yarn</code> / … -&gt; npm might be used but it seems to be too unreliable</li>
<li><code>tmux</code> &amp; <code>tmuxinator</code> - if you want to use them</li>
</ul>
<p><em>Warning</em>: Not using the indicated versions might lead to errors very hard to debug.</p>
<p>The <code>$GOPATH</code> must be set.</p>
<p>For <code>carbuy-go</code>: (this dependencies are OPTIONAL but highly recommended; they are required to locally compile the chaincode, outside the Docker container <code>fabric-ccenv-mpc</code>)</p>
<ul>
<li><p><code>swig</code> - We need a recent version of <code>swig</code>. The default version of swig in Ubuntu 16.04 has a bug: <a target="_blank" rel="noopener" href="https://github.com/swig/swig/issues/619">https://github.com/swig/swig/issues/619</a>. Tested with 3.0.12. For Ubuntu, inside <code>swig</code> source folder (downloaded from <a target="_blank" rel="noopener" href="http://www.swig.org/download.html">http://www.swig.org/download.html</a>):</p>
<pre><code>  sudo apt-get install libpcre3 libpcre3-dev
  ./configure
  make
  sudo make install</code></pre>
</li>
<li><p><code>emp-tookit</code> from the <code>carbuy</code> branch from <code>https://github.com/fabrice102/</code></p>
<ul>
<li><p>on Ubuntu:<br>go the the folder you want to install it:</p>
<pre><code>wget https://raw.githubusercontent.com/fabrice102/emp-readme/carbuy/scripts/setup_new_machine.sh -O emp_install.sh &amp;&amp; bash emp_install.sh</code></pre>
<p>and then follows instruction “on both” below</p>
</li>
<li><p>on macOS:<br>go the the folder you want to install it:</p>
<ul>
<li><p><code>git clone -b carbuy https://github.com/fabrice102/emp-readme.git</code></p>
</li>
<li><p>install pre-requisites using HomeBrew</p>
</li>
<li><p>add <code>export OPENSSL_ROOT_DIR=/usr/local/opt/openssl</code> to an init script (e.g., <code>~/.zshrc</code> if <code>zsh</code> is used) and run it</p>
</li>
<li><p>run</p>
<pre><code>  bash emp-readme/scripts/install_emp-tool.sh
  bash emp-readme/scripts/install_emp-ot.sh
  bash emp-readme/scripts/install_emp-m2pc.sh
  bash emp-readme/scripts/install_emp-sh2pc.sh</code></pre>
</li>
<li><p><em>warning</em>: the flag <code>-DUSE_RANDOM_DEVICE=yes</code> for <code>cmake</code> is required to not use <code>rdrand</code> on systems not supporting <code>rdrand</code></p>
</li>
<li><p>you can run <code>cmake</code> manually with the flags:</p>
<pre><code>  -DCMAKE_INSTALL_PREFIX=$HOME/usr  # for a local install
  -DCMAKE_BUILD_TYPE=DEBUG # for a debug version</code></pre>
<p>in the latter case, as we cannot use <code>cmake</code> within <code>carbuy-go</code>, you need to set up correctly <code>LD_LIBRARY_PATH</code> before doing anything on <code>carbuy-go</code>.<br>To avoid breaking <code>rpath</code> mechanisms, it is not recommended to change <code>LD_LIBRARY_PATH</code>, <code>LIBRARY_PATH</code>, or <code>DYLD_LIBRARY_PATH</code> for all the system.</p>
</li>
</ul>
</li>
<li><p>on both, add to <code>~/.zshrc</code>, <code>~/.bashrc</code>, or a similar file:</p>
<pre><code>export CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/usr/local/include/emp-tool:/usr/local/include/emp-sh2pc:/usr/local/include/emp-ot</code></pre>
</li>
</ul>
</li>
<li><p><code>dep</code> <a target="_blank" rel="noopener" href="https://github.com/golang/dep">https://github.com/golang/dep</a></p>
</li>
</ul>
<p>We assume that:</p>
<ul>
<li>The environment variable <code>$CARBUYDIR</code> points to an existing directory (e.g., <code>~/projects/carbuy</code>)</li>
<li>This repository <code>carbuy-client</code> is cloned in <code>$CARBUYDIR/carbuy-client</code>.</li>
<li>The repository <code>carbuy-go</code> is cloned in <code>$GOPATH/src/carbuy</code>.</li>
</ul>
<p>In other words:</p>
<pre><code>cd $CARBUYDIR
git clone [url carbuy-client] carbuy-client

cd $GOPATH/src
git clone [url carbuy-go] carbuy</code></pre>
<h3 id="Compilation-installation-of-dependencies"><a href="#Compilation-installation-of-dependencies" class="headerlink" title="Compilation / installation of dependencies"></a>Compilation / installation of dependencies</h3><p><em>Important</em>: These steps might need to be done again after an update.</p>
<h4 id="Fabric-v1-1-1-mpc"><a href="#Fabric-v1-1-1-mpc" class="headerlink" title="Fabric v1.1.1-mpc"></a>Fabric v1.1.1-mpc</h4><pre><code>mkdir -p $GOPATH/src/github.com/hyperledger
cd $GOPATH/src/github.com/hyperledger
git clone -b mpc_e2e https://github.com/fabrice102/fabric   # only the first time - if the folder &quot;fabric&quot; does not already exists, else check you are on the remote and mpc_e2e branch (cd fabric; git status)
cd fabric
git pull
make docker</code></pre>
<h4 id="carbuy-client"><a href="#carbuy-client" class="headerlink" title="carbuy-client"></a>carbuy-client</h4><pre><code>cd $CARBUYDIR/carbuy-client
git submodule update --init
cd fabric-sdk-node
yarn
gulp ca
cd ..
yarn

cd $CARBUYDIR/carbuy-client/fabric
./bootstrap.sh

cd $CARBUYDIR/carbuy-client/fabric/fabric-ccenv-carbuy
docker build --no-cache -t fabric-ccenv-carbuy:x86_64-1.1.1-mpc .</code></pre>
<h4 id="carbuy-go"><a href="#carbuy-go" class="headerlink" title="carbuy-go"></a>carbuy-go</h4><p>This step is only required if you want to locally compile the chaincode.</p>
<pre><code>cd $GOPATH/src/carbuy
dep ensure</code></pre>
<h3 id="1-Running-the-fabric"><a href="#1-Running-the-fabric" class="headerlink" title="1. Running the fabric"></a>1. Running the fabric</h3><p>Run</p>
<pre><code>cd &quot;$CARBUYDIR/carbuy-client/fabric/network&quot;
./byfn.sh -m generate
./byfn.sh -m up</code></pre>
<p>At the end, you should see</p>
<pre><code>===================== Anchor peers for org &quot;Org1MSP&quot; on &quot;mychannel&quot; is updated successfully =====================

========= All GOOD, BYFN execution completed ===========


 _____   _   _   ____
| ____| | \ | | |  _ \
|  _|   |  \| | | | | |
| |___  | |\  | | |_| |
|_____| |_| \_| |____/</code></pre>
<p>To stop the fabric:</p>
<pre><code>cd &quot;$CARBUYDIR/carbuy-client/fabric/network&quot;
./byfn.sh -m down</code></pre>
<p>In this case, the ledger is destroyed.</p>
<h3 id="2-Deploying-the-carbuy-application"><a href="#2-Deploying-the-carbuy-application" class="headerlink" title="2. Deploying the carbuy application"></a>2. Deploying the carbuy application</h3><p>Now you need to deploy the chaincode:</p>
<pre><code>cd $CARBUYDIR/carbuy-client
node deploy</code></pre>
<p>Each deploy generates a fresh <code>chaincodeID</code> which is stored in <code>chaincodeID.txt</code>.<br>Therefore only the last deployed chaincode is actually used (except if you change <code>chaincodeID.txt</code>).<br>Furthermore, each deployment starts from a fresh empty ledger that way.</p>
<p><em>Note</em>: <code>node deploy</code> is equivalent to <code>node deploy.js</code>.</p>
<h3 id="3-Populate-the-database"><a href="#3-Populate-the-database" class="headerlink" title="3. Populate the database"></a>3. Populate the database</h3><p>You can create initial entries into the database by using the <code>populate.sh</code> script:</p>
<pre><code>cd $CARBUYDIR/carbuy-client
./scripts/populate.sh</code></pre>
<p>Other smaller populate scripts are available (look for <code>populate*.sh</code>).</p>
<h3 id="4-Accessing-the-smartbid-application-using-command-line-OPTIONAL"><a href="#4-Accessing-the-smartbid-application-using-command-line-OPTIONAL" class="headerlink" title="4. Accessing the smartbid application using command line (OPTIONAL)"></a>4. Accessing the smartbid application using command line (OPTIONAL)</h3><p>Now, you can run the <code>invoke</code> (or <code>query</code> if you don’t need the transaction to be recorded) command with different parameters. The command gets the name of the function that is executed (e.g. createItem, etc.) and a structure that includes all of the variables for the command.</p>
<p>For example:</p>
<pre><code>cd $CARBUYDIR/carbuy-client

node invoke org0 createItem &#39;&#123;
    &quot;id&quot;:              &quot;715987522&quot;,
    &quot;sellerID&quot;:        &quot;org0&quot;,
    &quot;name&quot;:            &quot;House, White Plains&quot;,
    &quot;category&quot;:        &quot;Real Estate&quot;,
    &quot;description&quot;:     &quot;&quot;,
    &quot;auctionDateTime&quot;: 1494648000,
    &quot;startPrice&quot;:      10000,
    &quot;reservePrice&quot;:    &#39;$(node encrypt org0 30000)&#39;,
    &quot;soldPrice&quot;:       0,
    &quot;owner&quot;:           &quot;&quot;,
    &quot;status&quot;:          &quot;available&quot;
&#125;&#39;

node invoke org2 makeBid &#39;&#123;
    &quot;sellerID&quot;:        &quot;org0&quot;,
    &quot;itemID&quot;:          &quot;715987522&quot;,
    &quot;buyerID&quot;:         &quot;org2&quot;,
    &quot;price&quot;:           &#39;$(node encrypt org2 15000)&#39;,
    &quot;bidDateTime&quot;:     1493152448,
    &quot;valid&quot;:           true
&#125;&#39;

node invoke org1 createItem &#39;&#123;
    &quot;id&quot;:              &quot;715987524&quot;,
    &quot;sellerID&quot;:        &quot;org1&quot;,
    &quot;name&quot;:            &quot;House, Yorktown&quot;,
    &quot;category&quot;:        &quot;Real Estate&quot;,
    &quot;description&quot;:     &quot;&quot;,
    &quot;auctionDateTime&quot;: 1494648000,
    &quot;startPrice&quot;:      10000,
    &quot;reservePrice&quot;:    &#39;$(node encrypt org1 25000)&#39;,
    &quot;soldPrice&quot;:       0,
    &quot;owner&quot;:           &quot;&quot;,
    &quot;status&quot;:          &quot;available&quot;
&#125;&#39;

node query org2 getMyItemsWithBids org2</code></pre>
<p>The first argument is a comma-separated list of orgs to be contacted. The following arguments correspond to the invoke function of the chaincode and its arguments.</p>
<p>The reserve price is confidential. Therefore, an encryption of the price is saved on the chaincode and not the plaintextValue.</p>
<p><code>node encrypt</code> enables to encrypt data for a given organization.</p>
<h3 id="5-Running-the-web-server-OPTIONAL"><a href="#5-Running-the-web-server-OPTIONAL" class="headerlink" title="5. Running the web server (OPTIONAL)"></a>5. Running the web server (OPTIONAL)</h3><p>The web server provides a nicer interface than the command line.<br>To run it:</p>
<pre><code>cd $CARBUYDIR/carbuy-client
node app</code></pre>
<p>When developing for the web server, it is convenient to restart it whenever needed.<br>For that, you can use <code>nodemon</code>. To install it:</p>
<pre><code>cd $CARBUYDIR/carbuy-client
npm install -g nodemon</code></pre>
<p>To run the web server using <code>nodemon</code>:</p>
<pre><code>nodemon -e &#39;*&#39; app.js</code></pre>
<h3 id="Running-everything-above-automatically"><a href="#Running-everything-above-automatically" class="headerlink" title="Running everything above automatically"></a>Running everything above automatically</h3><p>Just run</p>
<pre><code>$CARBUYDIR/carbuy-client/scripts/start.sh</code></pre>
<p><em>TIP</em>: You can add the option <code>--populate</code> to <code>$CARBUYDIR/carbuy-client/scripts/start.sh</code>  to automatically populate after deploy.</p>
<p><em>TIP</em>: If you are in a hurry and want only a small set of data, you can just use <code>$CARBUYDIR/carbuy-client/scripts/populateQuick.sh</code> or <code>$CARBUYDIR/carbuy-client/scripts/populateMin.sh</code>.</p>
<p><em>TIP</em>: You can add the option <code>--no-app</code> to <code>$CARBUYDIR/carbuy-client/scripts/start.sh</code> to not launch the server. You can then run <code>$CARBUYDIR/carbuy-client/scripts/simpleTest.sh</code> to run a simple test auction.</p>
<h3 id="6-Stopping-everything"><a href="#6-Stopping-everything" class="headerlink" title="6. Stopping everything"></a>6. Stopping everything</h3><pre><code>$CARBUYDIR/carbuy-client/scripts/stop.sh</code></pre>
<h3 id="Updating"><a href="#Updating" class="headerlink" title="Updating"></a>Updating</h3><p>If you want to update all repos and compile what needs to be compiled, you can use</p>
<pre><code>$CARBUYDIR/carbuy-client/scripts/update.sh</code></pre>
<h2 id="Organization"><a href="#Organization" class="headerlink" title="Organization"></a>Organization</h2><ul>
<li><code>fabric/</code>: files used to run the fabric orderer, peers, …</li>
<li><code>static/</code>: static files of the web server</li>
<li><code>data/</code>: fake database for the web server, used to store e.g., picture of users and cars: picture of with <code>id</code> from org0 <code>org0ID</code> is stored in <code>data/&lt;org0ID&gt;/&lt;id&gt;.png</code></li>
<li><code>lib/</code>: templates, plugins, and other tools for the web server and <code>deploy.js</code>, …</li>
<li><code>scripts/</code>: various scripts to make life easier</li>
<li><code>test/</code>: mocha test files (to be run with <code>npm test</code>)</li>
<li><code>config.json</code>: configuration file for everything</li>
<li><code>manifest.js</code>: configuration file for the web server</li>
<li><code>deploy.js</code>, <code>invoke.js</code>, <code>query.js</code>: see above</li>
<li><code>chaincodeID.txt</code>: file created by <code>deploy.js</code> containing the chaincode ID of the last deployed chaincode</li>
</ul>
<h2 id="Unit-testing"><a href="#Unit-testing" class="headerlink" title="Unit testing"></a>Unit testing</h2><p>For the JS part, we are using <code>mocha</code>.<br>To run the tests:</p>
<pre><code>cd $CARBUYDIR/carbuy-client
npm test</code></pre>
<h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h2><h3 id="Peers"><a href="#Peers" class="headerlink" title="Peers"></a>Peers</h3><p>WARNING: This section is completely out of date.</p>
<p>Following the tutorial above, you get three peers: <code>org0</code>, <code>org1</code>, and <code>org2</code>.<br>However, the chaincode is oblivious to this and can work with any number of peers for most function calls, except when holding an auction which can only be done between three peers.</p>
<p>When the chaincode is deployed, the <code>init</code> function should be given the list of peer IDs.<br>This is automatically done by <code>deploy.js</code>.</p>
<p><em>Warning</em>: Peer name should only contains alphanumerical characters, <code>-</code> and <code>_</code>.</p>
<h3 id="Data-model-structures-stored-on-the-blockchain"><a href="#Data-model-structures-stored-on-the-blockchain" class="headerlink" title="Data model / structures stored on the blockchain"></a>Data model / structures stored on the blockchain</h3><p>The data model is defined explicitly in the chaincode (<code>carbuy-go</code>), and must be kept in synch manually.<br>More precisely, the structures are defined at the top of <code>seller.go</code>, <code>buyer.go</code>, and <code>encrypted.go</code>, in the folder <code>$GOPATH/src/carbuy/chaincode/</code>.</p>
<p>Comments indicate under which key the structures are stored on the blockchain.</p>
<h3 id="Invoke-queries"><a href="#Invoke-queries" class="headerlink" title="Invoke queries"></a>Invoke queries</h3><p>There are five functions which can be invoked: <code>createItem</code>, <code>getMyItemsWithBids</code>, <code>getOtherItemsWithBids</code>, <code>makeBid</code>, <code>holdAuction</code>. Each of these functions gets <code>(stub, args)</code>, where <code>args</code> includes all of the input parameters.</p>
<p>The invoke queries are called in <code>$GOPATH/src/carbuy/chaincode/main.go</code>, function <code>Invoke</code>.</p>
<h2 id="Workarounds-and-dirty-details"><a href="#Workarounds-and-dirty-details" class="headerlink" title="Workarounds and dirty details"></a>Workarounds and dirty details</h2><h3 id="carbuy-client-1"><a href="#carbuy-client-1" class="headerlink" title="carbuy-client"></a>carbuy-client</h3><h4 id="Npm-packages"><a href="#Npm-packages" class="headerlink" title="Npm packages"></a>Npm packages</h4><p>We use the following workarounds in <code>package.json</code>:</p>
<ul>
<li>The npm package <code>node-hashtable</code> does not compile on macos Sierra. We instead use <a target="_blank" rel="noopener" href="https://github.com/fabrice102/node-hashtable">https://github.com/fabrice102/node-hashtable</a>.</li>
<li>The npm package <code>grpc</code> seems to be manually installed at least on macos Sierra.</li>
<li>The npm package <code>winston</code> seems to be a dependency of fabric-client which has to be manually installed <code>node_modules/fabric-client/lib/utils.js:25:15</code>.</li>
</ul>
<h4 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h4><p>We only look at the events from the <code>org0</code> peer. This should never be an issue at least in our setting.</p>
<h3 id="carbuy-go-1"><a href="#carbuy-go-1" class="headerlink" title="carbuy-go"></a>carbuy-go</h3><h4 id="Vendor-and-package-versions"><a href="#Vendor-and-package-versions" class="headerlink" title="Vendor and package versions"></a>Vendor and package versions</h4><p>We use <code>golang dep</code> to simplify dependencies management.</p>
<p>However, for speed, we do not vendor anything in the chaincode. Instead <code>fabric-ccenv-carbuy</code> contains already everything that is requires.<br>Thus, no need for compilation each time and installation is faster.</p>
<h4 id="SWIG"><a href="#SWIG" class="headerlink" title="SWIG"></a>SWIG</h4><p>We need <code>swig</code>. For that we need two changes:</p>
<ul>
<li>Patch <code>node_modules/fabric-client/lib/packager/Golang.js</code> to support <code>swig</code>; concretely, we use <code>fabric-sdk-node</code> as a submodule, from branch <code>swig-support</code> from <a target="_blank" rel="noopener" href="https://github.com/fabrice102/fabric-sdk-node.git">https://github.com/fabrice102/fabric-sdk-node.git</a>.</li>
<li>Use of <code>CORE_CHAINCODE_BUILDER</code> and <code>$CARBUYDIR/carbuy-client/fabric/fabric-ccenv-carbuy</code>, cf above. We need a recent version of <code>swig</code>, because the default version of swig in Ubuntu 16.04 has a bug: <a target="_blank" rel="noopener" href="https://github.com/swig/swig/issues/619">https://github.com/swig/swig/issues/619</a>.</li>
</ul>
<h2 id="Other-remarks"><a href="#Other-remarks" class="headerlink" title="Other remarks"></a>Other remarks</h2><p>We use <a target="_blank" rel="noopener" href="https://github.com/hyperledger/fabric/blob/master/docs/source/asset_setup.rst">https://github.com/hyperledger/fabric/blob/master/docs/source/asset_setup.rst</a> as a base, with various changes.<br>In particular <code>peer0</code>, <code>peer1</code>, and <code>peer2</code> have been renamed <code>org0</code>, <code>org1</code>, and <code>org2</code>.<br>Furthermore the network id has been changed from <code>peer0</code> to <code>carbuy</code>.</p>
<p>The web server uses <code>hapijs</code> <a target="_blank" rel="noopener" href="https://hapijs.com/">https://hapijs.com/</a>.<br>The pages use <code>bootstrap</code> <a target="_blank" rel="noopener" href="https://getbootstrap.com/">https://getbootstrap.com/</a>.</p>
<p><em>IMPORTANT</em>: Keys must be changed on production. They are stored both in <code>$CARBUYDIR/carbuy-client/keys/</code> and in <code>$GOPATH/src/carbuy/helper/server/config/config.go</code>.</p>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="Error-GRPC-client-got-an-error-response-from-the-peer-Error-Error-executing-chaincode-Failed-to-execute-transaction-when-invoking"><a href="#Error-GRPC-client-got-an-error-response-from-the-peer-Error-Error-executing-chaincode-Failed-to-execute-transaction-when-invoking" class="headerlink" title="Error GRPC client got an error response from the peer. Error: Error executing chaincode: Failed to execute transaction when invoking"></a>Error <code>GRPC client got an error response from the peer. Error: Error executing chaincode: Failed to execute transaction</code> when invoking</h3><p>To debug this error, look at the logs of the chaincode</p>
<pre><code>docker logs carbuy-[peer]-[chaincodeid]-....</code></pre>
<p>Use autocompletion to make your life easier.</p>
<h3 id="Issues-with-npm-or-weird-JS-issues"><a href="#Issues-with-npm-or-weird-JS-issues" class="headerlink" title="Issues with npm or weird JS issues"></a>Issues with <code>npm</code> or weird JS issues</h3><p>Use <code>yarn</code> as <code>npm</code> often creates weird issues.</p>
<p>If you insist on using <code>npm</code>, here are some comments.</p>
<p>Might be useful to remove <code>node_modules</code> and <code>package-lock.json</code> and run <code>npm install</code> again.<br>True also inside <code>fabric-sdk-node</code>. (See requirements at the beginning.)</p>
<p>If problems with versions, might be useful to remove <code>package-lock.json</code> too.</p>
<p>See <a target="_blank" rel="noopener" href="https://github.com/npm/npm/issues/16839">https://github.com/npm/npm/issues/16839</a></p>
<h3 id="Issues-with-installation-of-chaincode"><a href="#Issues-with-installation-of-chaincode" class="headerlink" title="Issues with installation of chaincode"></a>Issues with installation of chaincode</h3><p>Check that you gave the latest <code>fabric-ccenv-carbuy</code> Docker image.<br>Otherwise run:</p>
<pre><code>cd $CARBUYDIR/carbuy-client/fabric/fabric-ccenv-carbuy
docker build --no-cache -t fabric-ccenv-carbuy:x86_64-1.1.0-alpha-mpc .</code></pre>
<h3 id="Other-random-errors"><a href="#Other-random-errors" class="headerlink" title="Other random errors"></a>Other random errors</h3><p>In some cases just rebooting the machine solves some errors.</p>
<h3 id="Chaincode-dead-lock"><a href="#Chaincode-dead-lock" class="headerlink" title="Chaincode dead lock"></a>Chaincode dead lock</h3><p>To debug send signal QUIT to process 1 in the docker container of the chaincode and look at the logs.<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/28699595/2945326">https://stackoverflow.com/a/28699595/2945326</a></p>
<h3 id="Errors-on-the-chaincode"><a href="#Errors-on-the-chaincode" class="headerlink" title="Errors on the chaincode"></a>Errors on the chaincode</h3><p>Debugging can be eased by changing PRINT_LINE define on top of <code>$GOPATH/src/carbuy/chaincode/mpc/mpc.cpp</code>.</p>
<h3 id="Acknowledgement"><a href="#Acknowledgement" class="headerlink" title="Acknowledgement"></a>Acknowledgement</h3><p>Thanks to Research fellow, Shai Halevi for his guidance and help.</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>Donate here.</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="He Jun 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="He Jun 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%AE%89%E5%85%A8%E5%A4%9A%E6%96%B9%E8%AE%A1%E7%AE%97/" rel="tag"># 安全多方计算</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/25/evening/" rel="prev" title="郁">
      <i class="fa fa-chevron-left"></i> 郁
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/02/lonesome/" rel="next" title="lonesome">
      lonesome <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#SmartBid"><span class="nav-number">1.</span> <span class="nav-text">SmartBid</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Getting-started"><span class="nav-number">1.1.</span> <span class="nav-text">Getting started</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Requirements"><span class="nav-number">1.1.1.</span> <span class="nav-text">Requirements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Compilation-installation-of-dependencies"><span class="nav-number">1.1.2.</span> <span class="nav-text">Compilation &#x2F; installation of dependencies</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Fabric-v1-1-1-mpc"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Fabric v1.1.1-mpc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#carbuy-client"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">carbuy-client</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#carbuy-go"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">carbuy-go</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Running-the-fabric"><span class="nav-number">1.1.3.</span> <span class="nav-text">1. Running the fabric</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Deploying-the-carbuy-application"><span class="nav-number">1.1.4.</span> <span class="nav-text">2. Deploying the carbuy application</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Populate-the-database"><span class="nav-number">1.1.5.</span> <span class="nav-text">3. Populate the database</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Accessing-the-smartbid-application-using-command-line-OPTIONAL"><span class="nav-number">1.1.6.</span> <span class="nav-text">4. Accessing the smartbid application using command line (OPTIONAL)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Running-the-web-server-OPTIONAL"><span class="nav-number">1.1.7.</span> <span class="nav-text">5. Running the web server (OPTIONAL)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-everything-above-automatically"><span class="nav-number">1.1.8.</span> <span class="nav-text">Running everything above automatically</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Stopping-everything"><span class="nav-number">1.1.9.</span> <span class="nav-text">6. Stopping everything</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Updating"><span class="nav-number">1.1.10.</span> <span class="nav-text">Updating</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Organization"><span class="nav-number">1.2.</span> <span class="nav-text">Organization</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unit-testing"><span class="nav-number">1.3.</span> <span class="nav-text">Unit testing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Model"><span class="nav-number">1.4.</span> <span class="nav-text">Model</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Peers"><span class="nav-number">1.4.1.</span> <span class="nav-text">Peers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-model-structures-stored-on-the-blockchain"><span class="nav-number">1.4.2.</span> <span class="nav-text">Data model &#x2F; structures stored on the blockchain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Invoke-queries"><span class="nav-number">1.4.3.</span> <span class="nav-text">Invoke queries</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Workarounds-and-dirty-details"><span class="nav-number">1.5.</span> <span class="nav-text">Workarounds and dirty details</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#carbuy-client-1"><span class="nav-number">1.5.1.</span> <span class="nav-text">carbuy-client</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Npm-packages"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">Npm packages</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Events"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">Events</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#carbuy-go-1"><span class="nav-number">1.5.2.</span> <span class="nav-text">carbuy-go</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Vendor-and-package-versions"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">Vendor and package versions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SWIG"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">SWIG</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-remarks"><span class="nav-number">1.6.</span> <span class="nav-text">Other remarks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Troubleshooting"><span class="nav-number">1.7.</span> <span class="nav-text">Troubleshooting</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-GRPC-client-got-an-error-response-from-the-peer-Error-Error-executing-chaincode-Failed-to-execute-transaction-when-invoking"><span class="nav-number">1.7.1.</span> <span class="nav-text">Error GRPC client got an error response from the peer. Error: Error executing chaincode: Failed to execute transaction when invoking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Issues-with-npm-or-weird-JS-issues"><span class="nav-number">1.7.2.</span> <span class="nav-text">Issues with npm or weird JS issues</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Issues-with-installation-of-chaincode"><span class="nav-number">1.7.3.</span> <span class="nav-text">Issues with installation of chaincode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-random-errors"><span class="nav-number">1.7.4.</span> <span class="nav-text">Other random errors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chaincode-dead-lock"><span class="nav-number">1.7.5.</span> <span class="nav-text">Chaincode dead lock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Errors-on-the-chaincode"><span class="nav-number">1.7.6.</span> <span class="nav-text">Errors on the chaincode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Acknowledgement"><span class="nav-number">1.7.7.</span> <span class="nav-text">Acknowledgement</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="He Jun"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">He Jun</p>
  <div class="site-description" itemprop="description">Like Sunday，Like Rain</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cool-jun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cool-jun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:15697404219@163.com" title="E-Mail → mailto:15697404219@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async="async"></script>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">He Jun</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'yC6HMe8HT9vQsskxW96mK1nE-gzGzoHsz',
      appKey     : 'k5q8VxTAtwXdTUJ0eRFXyESY',
      placeholder: "老铁，不想说2句吗？",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
